<h2 class="board__header" *ngIf="board">{{board.title}}</h2>
<div class="loading" *ngIf="!board">
  No board
</div>
<div class="board" *ngIf="board" cdkDropListGroup>

  <div class="board__column" *ngFor="let column of board?.columns">

    <div class="board__top-wrapper">
      <h3 class="board__column-header" *ngIf="!changerColumn.get(column.id)"
        (click)="onColumnHeaderClick(column.id)">{{column.title}}</h3>
      <mat-form-field *ngIf="changerColumn.get(column.id)" appearance="fill">
        <mat-label>Введите новое название</mat-label>
        <input matInput type="text" value={{column.title}} (keydown.enter)="changeName($event, column.id, column.title)"
          (blur)="changerColumn.set(column.id, false)" [formControl]="findFormcontrol(column.id)">
        <button mat-button mat-raised-button *ngIf="changerColumn.get(column.id) && !column.tasks?.length"
          (click)="deleteColumn(column.id)">Удалить</button>
        <mat-error *ngIf="findFormcontrol(column.id).getError('minlength')">Название меньше 4 символов</mat-error>
      </mat-form-field>
    </div>

    <ul *ngIf="column.tasks" cdkDropList [cdkDropListData]="column.tasks" class="board__task-list"
      (cdkDropListDropped)="drop($event, column.id)">
      <li class="board__task" *ngFor="let task of column.tasks" cdkDrag>
        <p class="board__task-header" routerLink={{task.id}} (mousedown)="taskId = task.id">{{task.title}}</p>
        <mat-icon (click)="deleteTask(task.id, column.id)" class="board__task-delete">delete</mat-icon>
      </li>
    </ul>

    <div class="board__task board-task--new"*ngIf="!isHidden">
      <button class="board__task-create" (click)="[isHidden = !isHidden, columnId = column.id]" >
        <mat-icon>add_circle_outline</mat-icon>
        Создать новую задачу
      </button>
    </div>

    <!-- Форма создания новой таски на самой доске -->
    <form class="example-form" [formGroup]="form" *ngIf="isHidden && column.id === columnId"
      (ngSubmit)="addToDo(column.id)">
      <mat-form-field appearance="fill">
        <mat-label>Заголовок задачи</mat-label>
        <input matInput type="text" formControlName="title" (blur) = "isHidden = !isHidden">
      </mat-form-field>
    </form>

  </div>

  <div class="board__new-column">
    <button *ngIf="!isHiddenColumn" mat-raised-button color="primary" (click)="isHiddenColumn = !isHiddenColumn">
      <mat-icon>add_circle_outline</mat-icon>
      Добавить колонку
    </button>
    <form [formGroup]="formColumns" (ngSubmit)="addColumn()" *ngIf="isHiddenColumn">
      <mat-form-field appearance="fill">
        <mat-label>Название колонки</mat-label>
        <input matInput type="text" formControlName="columnName">
      </mat-form-field>
      <button mat-raised-button color="primary" class="example-createToDo" type="submit"
        [disabled]="formColumns.invalid">Создать</button>
    </form>
  </div>
</div>
<router-outlet></router-outlet>
